# 元数据管理 需求文档

## 项目简介

元数据 管理系统 (MetaData Management System) 用于支持公司数据仓库元数据管理的需要。

## 技术栈

- **数据仓库**: 上海数据仓库技术栈（HDFS存储+Spark/Presto查询），云上SGP数据仓库技术栈（Google BigQuery存储+查询引擎）
- **MySQL**: 表的元数据管理信息存储，查询基于ES构建搜索，快速召回
- **缓存**: 缓存采用Redis存储
- **数据血缘**: 基于图数据库Nebula Graph做表和字段级别的数据血缘管理

## 元数据管理系统前端交互目录结构

```
metadata-management-system/
├── 表查询                      #表信息的查询      
├── 表创建和修改/                #表的创建和修改，修改需要审批 
│   ├── 表创建
│   ├── 表修改/
│   │   ├── 修改
│   │   ├── 评审
│   │   ├── 发布
├── 数据标准/                   #一些公共信息的维护
│   ├── 维度管理
│   ├── 标准字段
│   ├── 词根维护
├── 数仓管理/                   #管理数仓共信息
│   ├── 数仓分层
│   ├── 数仓主题
│   ├── 数据规范
│   ├── 数仓组织
├── 表操作历史                  #数仓的操作历史管理
└── 审批管理                    #主要是数仓表的变更管理       
```
## 表的查询
- 前端交互风格：采用Ant Design

### 表的信息搜索

#### 搜索对象
- 表名（表名模糊搜索，通过搜索到的表名自动匹配库名）
- 字段名（字段名称的模糊搜索，通过搜索到的字段信息自动匹配表名、库名）
- 库名（库名的模糊搜索）
- 库名+表名（库名+表名的模糊匹配）

#### 表信息的查询字段
- 责任人：表的所有者，Owner，个人的域账号信息
- 数据源：表存储的数据源，目前支持Hive/Paimon/Iceberg/ClickHouse/BigQuery/StarRocks
- 所属BU：所属的业务BU，机票/酒店/火车票/IBU/内容
- Hive账号：租户，一个业务单元可能会有多个租户，如hotel/hotel_tech/flight/flight_tech/bieng/bieng_tech
- 数仓分层：数仓所属的分层，ods/edw/cdm/mid/dim
- 一级主题：一级主题，用缩写指代，usr（User）/mkt（Marketing）/ord（Order）/fin（Finance）/prd（Product）/prj（Project Data）
- 二级主题：与一级主题存在级联关系，如usr下面有con(Consumer)/mem(Member)/ubt(UBT)等二级主题
- 敏感等级：主要是表的敏感等级，分L1/L2/L3/L4，等级越高越敏感
- 重要等级：表的重要等级，分P0/P1/P2/P3，数字越小越重要

#### 表信息搜索结果
- 搜索结果：搜索结果以表格形式展示

具体的展示信息如下：

| 字段名    | 类型       | 描述        |
|--------|----------|-----------|
| 表名     | `String` | 表名称       |
| 库名     | `String` | 库名        |
| 数据源    | `Enum`   | 数据源类型     |
| 表描述    | `富文本`    | 表的描述信息    |
| Hive账号 | `Enum`   | 租户对应的账号   |
| 表大小    | `long`   | 表大小，精确到字节 |
| 数仓分层   | `Enum`   | 表所在的分层    |
| 主题     | `Enum`   | 展示一二级主题   |
| 敏感等级   | `Enum`   | 表的敏感等级    |
| 责任人    | `Enum`   | 责任人，域账号展示 |
| 创建时间   | `Date`   | 表的创建时间    |

#### 表的详细信息展示
点击表名进入详细信息展示

- 表基础信息展示
详细字段信息如下：

| 字段名    | 类型       | 描述        |
|--------|----------|-----------|
| 表名     | `String` | 表名称       |
| 库名     | `String` | 库名        |
| 数据源    | `Enum`   | 数据源类型     |
| 表描述    | `富文本`    | 表的描述信息    |
| Hive账号 | `Enum`   | 租户对应的账号   |
| 表大小    | `long`   | 表大小，精确到字节 |
| 数仓分层   | `Enum`   | 表所在的分层    |
| 主题     | `Enum`   | 展示一二级主题   |
| 敏感等级   | `Enum`   | 表的敏感等级    |
| 责任人    | `Enum`   | 责任人，域账号展示 |
| 创建时间   | `Date`   | 表的创建时间    |

- 字段信息：以表格形式展示
详细字段信息如下：

  | 字段名  | 类型 | 描述             |
  |------|----|----------------|
  | 序号   | `int` | 字段序号，按照字段顺序排列  |
  | 字段名称 | `String` | 字段名称           |
  | 字段描述 | `富文本` | 字段信息的详细描述      |
  | 字段类型 | `Enum`   | 字段的存储类型，根据存储确定 |
  | 主键   | `Enum` | 是否主键           |
  | 空    | `Enum` | 是否可以为空         |
  | 加密   | `Enum` | 是否加密           |
  | 敏感等级 | `Enum` | 敏感等级           |
  | 操作   | `Enum` | 操作             |


## 表创建和修改
- 规范：表的创建和修改入口统一，根据数据源生成对应的建表SQL

### 表创建

#### 表创建需要输入的字段信息
具体的输入信息如下：

| 字段名    | 类型       | 描述              |
|--------|----------|-----------------|
| 表名     | `String` | 表名称             |
| 库名     | `String` | 库名              |
| 数据源    | `Enum`   | 数据源类型           |
| 表描述    | `富文本`    | 表的描述信息          |
| Hive账号 | `Enum`   | 租户对应的账号         |
| 数仓分层   | `Enum`   | 表所在的分层          |
| 主题     | `Enum`   | 展示一二级主题         |
| 敏感等级   | `Enum`   | 表的敏感等级          |
| 分区类型   | `Enum`   | 表的分区类型 ，全量/增量分区 |
| 重要等级   | `Enum`   | 表的重要等级          |
| 分区保留天数 | `int`    | 表分区保留天数         |
| 更新频率   | `int`    | 更新频率            |
| 自定义标签  | `Enum`   | 自定义的标签          |

#### 建表SQL
根据输入的字段信息，自动构建建表SQL，建表SQL所需的字段信息用户自行补全

- 表SQL语法校验：根据建表SQL指定的数据源提交到执行引擎做语法校验
- 设置表信息：根据引擎前置设置表信息

### 表修改

- 修改：自持字段级别修改
- 评审：内部审核流程，防止因为人为操作导致表不可用


